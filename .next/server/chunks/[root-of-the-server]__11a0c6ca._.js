module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},60029,69894,e=>{"use strict";e.i(23502);var t=e.i(29173);let r=globalThis.prisma??new t.PrismaClient({log:["error"]});function a(e,t){return({CREATED:["RAW_UPLOADED"],RAW_UPLOADED:["ASSIGNED"],ASSIGNED:["EDITING"],EDITING:["FINAL_UPLOADED"],FINAL_UPLOADED:["COMPLETED"],COMPLETED:[]})[e].includes(t)}function n(e){let{role:t,fileType:r,status:a}=e;return"CAMERAMAN"===t&&"RAW"===r?"CREATED"===a:"EDITOR"===t&&"FINAL"===r&&("EDITING"===a||"ASSIGNED"===a)}function i(e){return{id:e.id,name:e.name,date:e.date.toISOString(),cameramanId:e.cameramanId??null,editorId:e.editorId??null,status:e.status,driveFolderId_root:e.driveRootId??null,driveFolderId_raw:e.driveRawId??null,driveFolderId_edited:e.driveEditedId??null,driveFolderId_final:e.driveFinalId??null}}function d(e){return{id:e.id,eventId:e.eventId,uploadedBy:e.uploaderId,fileType:e.fileType,driveFileId:e.driveFileId??"",size:e.size,timestamp:e.createdAt.toISOString(),name:e.name}}function s(e){return{id:e.id,userId:e.userId,eventId:e.eventId??void 0,title:e.title,message:e.message,isRead:e.isRead,type:e.type??"EVENT_ASSIGNED",createdAt:e.createdAt.toISOString()}}async function o(e){return r.user.findUnique({where:{email:e.toLowerCase()}})}async function l(e){let t="ADMIN"===e.role?{}:"CAMERAMAN"===e.role?{cameramanId:e.id}:{editorId:e.id};return(await r.event.findMany({where:t,orderBy:{date:"desc"}})).map(i)}async function u(e){let t=await r.event.findUnique({where:{id:e}});return t?i(t):null}async function c(e,t){return(await r.file.findMany({where:{eventId:e,...t?{fileType:t}:{}},orderBy:{createdAt:"desc"}})).map(d)}async function p(e){let t=await r.file.findUnique({where:{id:e}});return t?d(t):null}async function I(e){return i(await r.event.create({data:{name:e.name,date:new Date(e.date),cameramanId:e.cameramanId,editorId:e.editorId??null,status:"CREATED"}}))}async function f(e,t){return r.$transaction(async r=>{let n=await r.event.findUnique({where:{id:e}});if(!n)return null;if(!a(n.status,t))throw Error(`Invalid status transition: ${n.status} -> ${t}`);return i(await r.event.update({where:{id:e},data:{status:t}}))})}async function m(e,t){var a;return{id:(a=await r.user.update({where:{id:e},data:{isFree:t}})).id,name:a.name,email:a.email,role:a.role,isFree:"EDITOR"===a.role?a.isFree:void 0}}async function v(e,t){return i(await r.event.update({where:{id:e},data:{editorId:t}}))}async function y(e){return r.$transaction(async t=>{let r=await t.event.findUnique({where:{id:e}});if(!r)return null;if(r.editorId)return i(r);let a=await t.user.findFirst({where:{role:"EDITOR",isFree:!0},orderBy:{createdAt:"asc"}});return a?(await t.user.update({where:{id:a.id},data:{isFree:!1}}),i(await t.event.update({where:{id:e},data:{editorId:a.id}}))):i(r)})}async function w(e){return d(await r.file.create({data:{eventId:e.eventId,uploaderId:e.uploadedBy,fileType:e.fileType,name:e.name,size:e.size,driveFileId:null}}))}async function E(e){return s(await r.notification.create({data:{userId:e.userId,eventId:e.eventId,title:e.title,message:e.message,type:e.type}}))}async function x(e){return(await r.notification.findMany({where:{userId:e},orderBy:{createdAt:"desc"}})).map(s)}async function A(e,t){let a=await r.notification.findUnique({where:{id:e}});return a&&a.userId===t?s(await r.notification.update({where:{id:e},data:{isRead:!0}})):null}e.s(["canTransition",()=>a,"canUploadFile",()=>n],69894),e.s(["addFile",()=>w,"autoAssignFreeEditor",()=>y,"createEvent",()=>I,"createNotification",()=>E,"getDbUserByEmail",()=>o,"getEventById",()=>u,"getFileById",()=>p,"listEventsForUser",()=>l,"listFilesForEvent",()=>c,"listNotificationsForUser",()=>x,"markNotificationRead",()=>A,"setEditor",()=>v,"setEditorFree",()=>m,"transitionEvent",()=>f],60029)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__11a0c6ca._.js.map