{"version":3,"sources":["../../../../components/upload/FileDropzone.tsx","../../../../lib/validation.ts","../../../../components/event/EventStatusActionButton.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport type { FileType } from \"@/lib/types\";\r\nimport { cn } from \"@/lib/cn\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { getAllowedMimeTypes } from \"@/lib/validation\";\r\n\r\nexport function FileDropzone({\r\n  eventId,\r\n  fileType,\r\n  label,\r\n}: {\r\n  eventId: string;\r\n  fileType: FileType;\r\n  label: string;\r\n}) {\r\n  const router = useRouter();\r\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\r\n  const [busy, setBusy] = React.useState(false);\r\n  const [dragging, setDragging] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n  const allowedMimeTypes = React.useMemo(() => getAllowedMimeTypes(fileType), [fileType]);\r\n  const acceptAttr = React.useMemo(() => {\r\n    // Convert MIME types to accept attribute format\r\n    return allowedMimeTypes.join(\",\");\r\n  }, [allowedMimeTypes]);\r\n\r\n  function validateFiles(files: File[]): string | null {\r\n    if (files.length === 0) return \"No files selected\";\r\n\r\n    const errors: string[] = [];\r\n    const MAX_IMAGE_SIZE = 50 * 1024 * 1024; // 50 MB\r\n    const MAX_VIDEO_SIZE = 10 * 1024 * 1024 * 1024; // 10 GB\r\n\r\n    for (const file of files) {\r\n      // Check MIME type\r\n      if (!allowedMimeTypes.includes(file.type)) {\r\n        errors.push(`${file.name}: Invalid file type. Allowed: ${allowedMimeTypes.join(\", \")}`);\r\n        continue;\r\n      }\r\n\r\n      // Check file size\r\n      const isImage = file.type.startsWith(\"image/\");\r\n      const isVideo = file.type.startsWith(\"video/\");\r\n      const maxSize = isImage ? MAX_IMAGE_SIZE : isVideo ? MAX_VIDEO_SIZE : MAX_IMAGE_SIZE;\r\n\r\n      if (file.size > maxSize) {\r\n        const maxSizeMB = Math.round(maxSize / (1024 * 1024));\r\n        const fileSizeMB = Math.round(file.size / (1024 * 1024));\r\n        errors.push(\r\n          `${file.name}: File size (${fileSizeMB} MB) exceeds maximum (${maxSizeMB} MB) for ${isImage ? \"images\" : \"videos\"}`,\r\n        );\r\n      }\r\n    }\r\n\r\n    return errors.length > 0 ? errors.join(\"\\n\") : null;\r\n  }\r\n\r\n  async function upload(files: File[]) {\r\n    if (files.length === 0) return;\r\n\r\n    // Client-side validation\r\n    const validationError = validateFiles(files);\r\n    if (validationError) {\r\n      setError(validationError);\r\n      return;\r\n    }\r\n\r\n    setBusy(true);\r\n    setError(null);\r\n\r\n    const form = new FormData();\r\n    for (const f of files) form.append(\"files\", f);\r\n\r\n    const res = await fetch(`/api/upload?eventId=${encodeURIComponent(eventId)}&fileType=${fileType}`, {\r\n      method: \"POST\",\r\n      body: form,\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const data = (await res.json().catch(() => null)) as any;\r\n      setError(data?.error ?? \"Upload failed\");\r\n      setBusy(false);\r\n      return;\r\n    }\r\n\r\n    setBusy(false);\r\n    router.refresh();\r\n  }\r\n\r\n  function onPick() {\r\n    inputRef.current?.click();\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <div\r\n        className={cn(\r\n          \"rounded-2xl border border-dashed border-border bg-surface/40 p-6 transition\",\r\n          dragging ? \"border-primary/60 bg-primary/10\" : \"hover:bg-surface/60\",\r\n        )}\r\n        onDragEnter={(e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setDragging(true);\r\n        }}\r\n        onDragOver={(e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setDragging(true);\r\n        }}\r\n        onDragLeave={(e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setDragging(false);\r\n        }}\r\n        onDrop={(e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setDragging(false);\r\n          void upload(Array.from(e.dataTransfer.files));\r\n        }}\r\n      >\r\n        <div className=\"flex flex-col items-start gap-2 sm:flex-row sm:items-center sm:justify-between\">\r\n          <div>\r\n            <div className=\"text-sm font-medium\">{label}</div>\r\n            <div className=\"mt-1 text-xs text-muted-foreground\">\r\n              Drag & drop files here, or choose from your device. (Drive upload streaming will be added next.)\r\n            </div>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button type=\"button\" variant=\"secondary\" onClick={onPick} disabled={busy}>\r\n              Choose files\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <input\r\n          ref={inputRef}\r\n          className=\"hidden\"\r\n          type=\"file\"\r\n          multiple\r\n          accept={acceptAttr}\r\n          onChange={(e) => {\r\n            const files = Array.from(e.target.files ?? []);\r\n            void upload(files);\r\n            // Reset input so same file can be selected again if needed\r\n            if (inputRef.current) {\r\n              inputRef.current.value = \"\";\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {error ? (\r\n        <div className=\"rounded-xl border border-warning/30 bg-warning/10 px-3 py-2 text-sm text-warning\">\r\n          {error}\r\n        </div>\r\n      ) : null}\r\n      {busy ? <div className=\"text-xs text-muted-foreground\">Uploading…</div> : null}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","import type { FileType } from \"@/lib/types\";\r\n\r\n// Allowed MIME types for RAW uploads (Cameraman)\r\nconst ALLOWED_RAW_MIME_TYPES = [\r\n  \"image/jpeg\",\r\n  \"image/png\",\r\n  \"image/heic\",\r\n  \"video/mp4\",\r\n  \"video/quicktime\",\r\n] as const;\r\n\r\n// Allowed MIME types for FINAL uploads (Editor)\r\nconst ALLOWED_FINAL_MIME_TYPES = [\r\n  \"image/jpeg\",\r\n  \"image/png\",\r\n  \"video/mp4\",\r\n] as const;\r\n\r\n// File size limits (in bytes)\r\nconst MAX_IMAGE_SIZE = 50 * 1024 * 1024; // 50 MB\r\nconst MAX_VIDEO_SIZE = 10 * 1024 * 1024 * 1024; // 10 GB\r\n\r\nexport interface ValidationResult {\r\n  valid: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport function validateFile(file: File, fileType: FileType): ValidationResult {\r\n  // Check MIME type\r\n  const allowedMimeTypes =\r\n    fileType === \"RAW\" ? ALLOWED_RAW_MIME_TYPES : ALLOWED_FINAL_MIME_TYPES;\r\n\r\n  if (!allowedMimeTypes.includes(file.type as any)) {\r\n    const allowedList = allowedMimeTypes.join(\", \");\r\n    return {\r\n      valid: false,\r\n      error: `Invalid file type. Allowed types for ${fileType} uploads: ${allowedList}`,\r\n    };\r\n  }\r\n\r\n  // Check file size\r\n  const isImage = file.type.startsWith(\"image/\");\r\n  const isVideo = file.type.startsWith(\"video/\");\r\n  const maxSize = isImage ? MAX_IMAGE_SIZE : isVideo ? MAX_VIDEO_SIZE : MAX_IMAGE_SIZE;\r\n\r\n  if (file.size > maxSize) {\r\n    const maxSizeMB = Math.round(maxSize / (1024 * 1024));\r\n    const fileSizeMB = Math.round(file.size / (1024 * 1024));\r\n    return {\r\n      valid: false,\r\n      error: `File size (${fileSizeMB} MB) exceeds maximum allowed size (${maxSizeMB} MB) for ${isImage ? \"images\" : \"videos\"}`,\r\n    };\r\n  }\r\n\r\n  return { valid: true };\r\n}\r\n\r\nexport function getAllowedMimeTypes(fileType: FileType): readonly string[] {\r\n  return fileType === \"RAW\" ? ALLOWED_RAW_MIME_TYPES : ALLOWED_FINAL_MIME_TYPES;\r\n}\r\n\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport type { EventStatus } from \"@/lib/types\";\r\nimport { Button } from \"@/components/ui/Button\";\r\n\r\nexport function EventStatusActionButton({\r\n  eventId,\r\n  nextStatus,\r\n  children,\r\n  variant = \"primary\",\r\n}: {\r\n  eventId: string;\r\n  nextStatus: EventStatus;\r\n  children: React.ReactNode;\r\n  variant?: \"primary\" | \"secondary\" | \"ghost\";\r\n}) {\r\n  const router = useRouter();\r\n  const [busy, setBusy] = React.useState(false);\r\n\r\n  async function run() {\r\n    setBusy(true);\r\n    await fetch(`/api/events/${encodeURIComponent(eventId)}`, {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ nextStatus }),\r\n    });\r\n    setBusy(false);\r\n    router.refresh();\r\n  }\r\n\r\n  return (\r\n    <Button onClick={run} disabled={busy} variant={variant}>\r\n      {busy ? \"Working…\" : children}\r\n    </Button>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}